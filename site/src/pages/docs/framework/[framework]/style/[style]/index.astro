---

export const prerender = false; // since we're reading cookies

import { isValidFramework, isValidStyleForFramework } from '@/types/docs';
import { getPreferencesServer } from '@/utils/docs/preferences';
import { resolveIndexRedirect } from '@/utils/docs/routing';

const { framework, style } = Astro.params;

if (!isValidFramework(framework)) {
  return new Response('Not Found', { status: 404 });
}

if (!style) {
  return Astro.redirect(`/docs/framework/${framework}`, 307);
}

if (!isValidStyleForFramework(framework, style)) {
  return new Response('Not Found', { status: 404 });
}

const preferences = getPreferencesServer(Astro.cookies);
const { url } = resolveIndexRedirect({
  preferences,
  params: { framework, style },
});

return Astro.redirect(url, 307);
---
